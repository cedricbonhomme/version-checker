{% extends "layout.html" %}}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-5">
            <div class="card">
                <div class="card-body">
                    Latest release: {{ last_release }}<br />
                    {{ software }} on the <a href="https://open-source-security-software.net/project/{{ software }}">Open Source Security Software</a> directory.
                </div>
            </div>
            <br />
        </div>
    </div>
    <div class="row">
        <div class="col-md-5">
            <h2>Versions distribution</h2>
            <canvas id="versions-pie-chart" width="100%" height="100%"></canvas>
            <p class="text-justify">This graph provides <b>an overview</b> of the versions of {{ software }} instances deployed around the world. It cannot be considered as reliable.</p>
        </div>
        <div class="col-md-5 offset-md-2">
            <h2>Browsers distribution</h2>
            <canvas id="browsers-pie-chart" width="100%" height="100%"></canvas>
            <p class="text-justify">This graph shows the most commonly used Web browsers with {{ software }}.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-5">
            <br />
            <h2>Languages distribution</h2>
            <canvas id="languages-pie-chart" width="100%" height="100%"></canvas>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    var colors = ['rgba(230, 25, 75, 0.2)', 'rgba(60, 180, 75, 0.2)',
        'rgba(255, 225, 25, 0.2)', 'rgba(0, 130, 200, 0.2)', 'rgba(245, 130, 48, 0.2)',
        'rgba(145, 30, 180, 0.2)', 'rgba(70, 240, 240, 0.2)', 'rgba(240, 50, 230, 0.2)',
        'rgba(210, 245, 60, 0.2)', 'rgba(250, 190, 190, 0.2)', 'rgba(0, 128, 128, 0.2)',
        'rgba(230, 190, 255, 0.2)', 'rgba(170, 110, 40, 0.2)', 'rgba(255, 250, 200, 0.2)',
        'rgba(128, 0, 0, 0.2)', 'rgba(170, 255, 195, 0.2)', 'rgba(128, 128, 0, 0.2)',
        'rgba(255, 215, 180, 0.2)', 'rgba(0, 0, 128, 0.2)', 'rgba(128, 128, 128, 0.2)',
        'rgba(255, 255, 255, 0.2)','rgba(0, 0, 0, 0.2)'];

    $.ajax({
        url: "{{ url_for('stats_bp.versions', software=software) }}",
        dataType: "json",
        contentType: "application/json",
        success: function(versions) {
            var ctx = document.getElementById("versions-pie-chart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(versions),
                    datasets: [{
                        data: Object.values(versions),
                        borderWidth: 1,
                        backgroundColor: colors
                    }]
                }});
        }
    });

    $.ajax({
        url: "{{ url_for('stats_bp.browsers', software=software) }}",
        dataType: "json",
        contentType: "application/json",
        success: function(browsers) {
            var ctx = document.getElementById("browsers-pie-chart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(browsers),
                    datasets: [{
                        data: Object.values(browsers),
                        borderWidth: 1,
                        backgroundColor: colors
                    }]
                }});
        }
    });

    $.ajax({
        url: "{{ url_for('stats_bp.languages', software=software) }}",
        dataType: "json",
        contentType: "application/json",
        success: function(languages) {
            var ctx = document.getElementById("languages-pie-chart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(languages),
                    datasets: [{
                        data: Object.values(languages),
                        borderWidth: 1,
                        backgroundColor: colors
                    }]
                }});
        }
    });

});
</script>
{% endblock %}
